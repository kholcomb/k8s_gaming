✅ SOLUTION HINT

Complete Fix:
=============

Here's exactly what to change in broken.yaml:

**Find This Section:**
```yaml
apiVersion: networking.k8s.io/v1
kind: NetworkPolicy
metadata:
  name: backend-network-policy
  namespace: k8squest
spec:
  podSelector:
    matchLabels:
      app: backend
  policyTypes:
  - Ingress
  ingress:
  - from:
    - podSelector:
        matchLabels:
          app: admin-tool    # ❌ WRONG LABEL
    ports:
    - protocol: TCP
      port: 8080
```

**Change It To:**
```yaml
apiVersion: networking.k8s.io/v1
kind: NetworkPolicy
metadata:
  name: backend-network-policy
  namespace: k8squest
spec:
  podSelector:
    matchLabels:
      app: backend
  policyTypes:
  - Ingress
  ingress:
  - from:
    - podSelector:
        matchLabels:
          app: frontend      # ✅ CORRECT LABEL
    ports:
    - protocol: TCP
      port: 8080
```

**The Only Change:**
Line to modify: `app: admin-tool` → `app: frontend`

Step-by-Step:
-------------

1. **Edit broken.yaml:**
   Find the NetworkPolicy section and change the label from `admin-tool` to `frontend`.

2. **Apply the fix:**
   ```bash
   kubectl apply -f broken.yaml
   ```

   You should see:
   ```
   pod/frontend unchanged
   pod/backend unchanged
   service/backend-service unchanged
   networkpolicy.networking.k8s.io/backend-network-policy configured
   ```

3. **Verify the NetworkPolicy:**
   ```bash
   kubectl describe networkpolicy backend-network-policy -n k8squest
   ```

   Look for:
   ```
   Allowed ingress traffic:
     To Port: 8080/TCP
     From:
       PodSelector: app=frontend
   ```

4. **Check frontend logs:**
   ```bash
   kubectl logs frontend -n k8squest --tail=10
   ```

   You should now see:
   ```
   API Response: Success
   API Response: Success
   API Response: Success
   ```

   No more connection timeouts!

5. **Watch it work in real-time:**
   ```bash
   kubectl logs frontend -n k8squest -f
   ```

   Press Ctrl+C to stop watching.

Why This Works:
---------------

**Before (broken):**
- NetworkPolicy says: "Only allow traffic from pods with label `app: admin-tool`"
- Frontend has label: `app: frontend`
- Match? NO → Connection denied

**After (fixed):**
- NetworkPolicy says: "Only allow traffic from pods with label `app: frontend`"
- Frontend has label: `app: frontend`
- Match? YES → Connection allowed ✅

Understanding the Flow:
-----------------------

```
┌──────────────────┐
│  Frontend Pod    │
│  app: frontend   │───┐
│  tier: web       │   │
└──────────────────┘   │
                       │ Tries to connect to backend-service:8080
                       │
                       ▼
              ┌────────────────────┐
              │  NetworkPolicy     │
              │  Checks: Is source │
              │  pod labeled       │──── YES! app=frontend matches
              │  app=frontend?     │
              └────────────────────┘
                       │
                       │ Traffic allowed
                       │
                       ▼
┌──────────────────────────────────┐
│  Backend Pod                     │
│  app: backend                    │
│  tier: api                       │
│  Receives request ✅             │
└──────────────────────────────────┘
```

Testing Other Scenarios:
-------------------------

Try creating a pod with a DIFFERENT label to verify security:

```bash
kubectl run test-pod -n k8squest --image=busybox:1.36 --labels="app=unauthorized" -- sleep 3600

# Try to connect from this pod
kubectl exec test-pod -n k8squest -- wget -q -O- http://backend-service:8080 --timeout=3
```

This should TIMEOUT because `app: unauthorized` doesn't match `app: frontend`.

The NetworkPolicy is working correctly - it allows frontend but blocks others!

Validation:
-----------

Run the validation script:
```bash
./validate.sh
```

You should see: ✅ VALIDATION PASSED!

---
Check solution.yaml to see the complete working configuration.

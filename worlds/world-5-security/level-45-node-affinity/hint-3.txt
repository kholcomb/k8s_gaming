# ðŸ’¡ HINT 3: Complete Solution

## Step 1: Label a Node

```bash
# Label the control-plane node for GPU workloads
kubectl label nodes kind-control-plane accelerator=gpu

# Verify label was added
kubectl get nodes --show-labels | grep accelerator
```

## Step 2: Fix the Pod's NodeAffinity

```yaml
apiVersion: v1
kind: Pod
metadata:
  name: gpu-workload
  namespace: k8squest
spec:
  containers:
  - name: ml-training
    image: nginx:latest
    command: ['sh', '-c', 'echo "GPU workload running"; sleep 3600']
  affinity:
    nodeAffinity:
      # âœ… REQUIRED: Must match
      requiredDuringSchedulingIgnoredDuringExecution:
        nodeSelectorTerms:
        - matchExpressions:
          - key: accelerator  # âœ… Matches label we added
            operator: In
            values:
            - gpu  # âœ… Matches label value
      # âœ… PREFERRED: Nice to have
      preferredDuringSchedulingIgnoredDuringExecution:
      - weight: 100
        preference:
          matchExpressions:
          - key: kubernetes.io/hostname
            operator: In
            values:
            - kind-control-plane
```

## Step 3: Apply and Verify

```bash
# Apply the fixed configuration
kubectl apply -f solution.yaml

# Watch pod status
kubectl get pod gpu-workload -n k8squest --watch

# Should transition: Pending â†’ Running

# Verify it's on the right node
kubectl get pod gpu-workload -n k8squest -o wide
```

## Complete Commands

```bash
# 1. Label node
kubectl label nodes kind-control-plane accelerator=gpu

# 2. Apply solution
kubectl apply -f solution.yaml

# 3. Verify
kubectl get pod gpu-workload -n k8squest
kubectl describe pod gpu-workload -n k8squest | grep "Node:"

# 4. Run validation
./validate.sh
```

## Required vs Preferred

### Required (Must Have)
```yaml
requiredDuringSchedulingIgnoredDuringExecution:
  nodeSelectorTerms:
  - matchExpressions:
    - key: accelerator
      operator: In
      values: [gpu]
```
- Pod won't schedule if no match
- Hard requirement

### Preferred (Nice to Have)
```yaml
preferredDuringSchedulingIgnoredDuringExecution:
- weight: 100  # Higher weight = higher preference
  preference:
    matchExpressions:
    - key: disk-type
      operator: In
      values: [ssd]
```
- Pod will schedule even if no match
- Soft preference
- Weight: 1-100 (higher = more preferred)

---

**Run the validation** to confirm everything works!

```bash
./validate.sh
```
